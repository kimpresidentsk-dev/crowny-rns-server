â€» â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
â€»  CrownyOS ì›¹ ê²Œì´íŠ¸ì›¨ì´ â€” í•œì„ ì–´ êµ¬í˜„
â€»  crownybus.com/ì´ë¦„ â†” ctp://ì´ë¦„.crowny
â€»  ì„¸ê³„ ìµœì´ˆ í•œì„ ì–´ ì›¹ì„œë²„
â€» â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ê°€ì ¸ì˜¤ê¸° json, time, os, re
http.serverì—ì„œ ê°€ì ¸ì˜¤ê¸° HTTPServer, BaseHTTPRequestHandler
urllib.parseì—ì„œ ê°€ì ¸ì˜¤ê¸° urlparse, parse_qs
ë“±ë¡ì†Œì—ì„œ ê°€ì ¸ì˜¤ê¸° CTPë“±ë¡ì†Œ, ì´ë¦„ê·œì¹™, ì„œë¹„ìŠ¤ì¢…ë¥˜

ë²„ì „ = "1.0.0-í•œì„ "
í¬íŠ¸ = ì •ìˆ˜(os.environ.get("PORT", 8080))
RNS = CTPë“±ë¡ì†Œ()


â€» â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
â€» HTML ìŠ¤íƒ€ì¼ (ì´ˆì½œë¦¿ í…Œë§ˆ)
â€» â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ìŠ¤íƒ€ì¼ = """
:root{--bg:#1a1208;--bg2:#2c1e10;--card:#342518;--bd:#4e3428;--fg:#fff8f0;--dim:#a89080;--mute:#6b5b50;--gold:#d4a574;--amber:#e8b86d;--copper:#b87333;--up:#4ade80;--dn:#f87171}
*{margin:0;padding:0;box-sizing:border-box}
body{background:var(--bg);color:var(--fg);font-family:'Pretendard','Apple SD Gothic Neo',sans-serif;font-size:13px;min-height:100vh}
.hd{background:var(--bg2);border-bottom:1px solid var(--bd);padding:14px 24px;display:flex;align-items:center;justify-content:space-between}
.logo{font-size:20px;font-weight:700;color:var(--gold)}.logo span{color:var(--dim);font-size:12px;font-weight:400;margin-left:8px}
.nav{display:flex;gap:6px}.nav a{padding:6px 14px;border-radius:6px;color:var(--dim);text-decoration:none;font-size:12px;border:1px solid transparent;transition:.2s}.nav a:hover,.nav a.on{color:var(--gold);border-color:var(--bd);background:var(--bg)}
.main{max-width:1000px;margin:0 auto;padding:24px}
.card{background:var(--card);border:1px solid var(--bd);border-radius:10px;padding:16px;margin-bottom:12px}
.card h3{font-size:13px;color:var(--gold);margin-bottom:10px;font-weight:600}
.mono{font-family:'D2Coding','Menlo',monospace}
.grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(280px,1fr));gap:10px;margin-bottom:16px}
.svc-card{background:var(--card);border:1px solid var(--bd);border-radius:10px;padding:16px;cursor:pointer;transition:.2s;text-decoration:none;color:var(--fg);display:block}
.svc-card:hover{border-color:var(--gold);transform:translateY(-2px)}
.svc-icon{font-size:28px;margin-bottom:6px}
.svc-name{font-size:14px;font-weight:700;color:var(--gold)}
.svc-desc{font-size:11px;color:var(--dim);margin-top:4px}
.svc-addr{font-family:'D2Coding',monospace;font-size:10px;color:var(--mute);margin-top:6px;background:var(--bg);padding:3px 6px;border-radius:4px;display:inline-block}
.btn{border:none;border-radius:6px;padding:8px 16px;cursor:pointer;font-size:12px;font-weight:600;transition:.2s;background:var(--gold);color:#1a1208}.btn:hover{background:var(--amber)}
.inp{background:var(--bg);border:1px solid var(--bd);border-radius:6px;padding:8px 10px;color:var(--fg);font-size:12px;width:100%}
.tag{display:inline-block;padding:2px 8px;border-radius:4px;font-size:10px;background:var(--bg);border:1px solid var(--bd);color:var(--dim);margin:2px}
.hero{text-align:center;padding:40px 0 30px}
.hero h1{font-size:28px;color:var(--gold);margin-bottom:8px}
.hero p{color:var(--dim);font-size:14px}
.stat-row{display:flex;gap:20px;justify-content:center;margin:20px 0}
.stat-item{text-align:center}.stat-item .v{font-size:20px;font-weight:700;color:var(--amber);font-family:'D2Coding',monospace}.stat-item .l{font-size:10px;color:var(--mute);margin-top:2px}
.footer{text-align:center;padding:30px;color:var(--mute);font-size:11px}
.err{color:var(--dn)}.ok{color:var(--up)}
select.inp{appearance:auto}
"""

ë„¤ë¹„ = """
<div class="hd">
  <a href="/" style="text-decoration:none"><div class="logo">ğŸ› CrownyOS <span>ê· í˜•ì‚¼ì§„ ë„¤íŠ¸ì›Œí¬ â€” í•œì„ ì–´</span></div></a>
  <div class="nav">
    <a href="/">ì„œë¹„ìŠ¤</a>
    <a href="/trading">íŠ¸ë ˆì´ë”©</a>
    <a href="/rns">RNS</a>
    <a href="/register">ë“±ë¡</a>
  </div>
</div>
"""


â€» â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
â€» í˜ì´ì§€ ìƒì„± í•¨ìˆ˜ë“¤
â€» â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

í•¨ìˆ˜ í˜ì´ì§€(ì œëª©, ë³¸ë¬¸, í™œì„±=""):
    nav = ë„¤ë¹„
    ë§Œì•½ í™œì„±:
        nav = nav.replace(f'href="/{í™œì„±}"', f'href="/{í™œì„±}" class="on"')
    ë°˜í™˜ f"""<!DOCTYPE html><html lang="ko"><head>
<meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1.0">
<title>{ì œëª©} â€” CrownyOS í•œì„ ì–´</title><style>{ìŠ¤íƒ€ì¼}</style></head>
<body>{nav}<div class="main">{ë³¸ë¬¸}</div>
<div class="footer">CrownyOS ê· í˜•ì‚¼ì§„ ì»´í“¨íŒ… â€” í•œì„ ì–´(HanSeon Language)ë¡œ êµ¬ë™<br>
crownybus.com/ì´ë¦„ â†” ctp://ì´ë¦„.crowny</div></body></html>"""


í•¨ìˆ˜ í¬íƒˆí˜ì´ì§€():
    ì„œë¹„ìŠ¤ëª©ë¡ = RNS.ì „ì²´ëª©ë¡()
    í†µê³„ = RNS.í†µê³„()

    ì¹´ë“œë“¤ = ""
    ê°ê° s ì•ˆì— ì„œë¹„ìŠ¤ëª©ë¡:
        ì¹´ë“œë“¤ += f"""<a href="/{s['name']}" class="svc-card">
<div class="svc-icon">{s['icon']}</div>
<div class="svc-name">{s['title']}</div>
<div class="svc-desc">{s['desc']}</div>
<div style="margin-top:6px">
  <span class="svc-addr">ctp://{s['name']}.crowny</span>
  <span class="tag">{s['service']}</span>
  <span class="tag">{s['hits']}íšŒ</span>
</div></a>"""

    ë³¸ë¬¸ = f"""
<div class="hero">
  <h1>ğŸ› CrownyOS ë„¤íŠ¸ì›Œí¬</h1>
  <p>ê· í˜•ì‚¼ì§„ ì»´í“¨íŒ… â€” í•œì„ ì–´(HanSeon)ë¡œ êµ¬ë™ë˜ëŠ” CTP ì„œë¹„ìŠ¤ í¬íƒˆ</p>
  <div class="stat-row">
    <div class="stat-item"><div class="v">{í†µê³„['records']}</div><div class="l">ì„œë¹„ìŠ¤</div></div>
    <div class="stat-item"><div class="v">{í†µê³„['services']}</div><div class="l">íƒ€ì…</div></div>
    <div class="stat-item"><div class="v">{í†µê³„['total_hits']}</div><div class="l">ì¡°íšŒ</div></div>
  </div>
  <div style="margin-top:8px"><span class="tag" style="border-color:var(--gold);color:var(--gold)">ğŸ‡°ğŸ‡· í•œì„ ì–´ v1.0 êµ¬ë™</span></div>
</div>
<div class="grid">{ì¹´ë“œë“¤}</div>
"""
    ë°˜í™˜ í˜ì´ì§€("í¬íƒˆ", ë³¸ë¬¸)


í•¨ìˆ˜ ë“±ë¡í˜ì´ì§€(ë©”ì‹œì§€=""):
    ì˜µì…˜ë“¤ = "".join(f'<option value="{t}">{t}</option>' ê°ê° t ì•ˆì— ì„œë¹„ìŠ¤ì¢…ë¥˜)
    ì•Œë¦¼ = f'<div class="card" style="border-color:var(--gold)"><p>{ë©”ì‹œì§€}</p></div>' ë§Œì•½ ë©”ì‹œì§€ ì•„ë‹ˆë©´ ""

    ë³¸ë¬¸ = f"""
<div class="hero" style="padding:20px 0">
  <h1>ğŸ“ ì„œë¹„ìŠ¤ ë“±ë¡</h1>
  <p>CTP ë„¤íŠ¸ì›Œí¬ì— ìƒˆ ì„œë¹„ìŠ¤ë¥¼ ë“±ë¡í•˜ì„¸ìš”</p>
</div>
{ì•Œë¦¼}
<div class="card">
  <h3>ìƒˆ ì„œë¹„ìŠ¤ ë“±ë¡</h3>
  <form method="POST" action="/register" style="display:grid;gap:10px;max-width:500px">
    <div>
      <label style="font-size:11px;color:var(--dim);display:block;margin-bottom:4px">ì„œë¹„ìŠ¤ ì´ë¦„ (ì˜ì–´, ìˆ«ì, _, -)</label>
      <div style="display:flex;align-items:center;gap:4px">
        <span style="color:var(--mute);font-size:12px;font-family:monospace">ctp://</span>
        <input name="name" class="inp mono" placeholder="my-service" pattern="[a-zA-Z][a-zA-Z0-9_-]*" required style="flex:1">
        <span style="color:var(--mute);font-size:12px;font-family:monospace">.crowny</span>
      </div>
    </div>
    <div>
      <label style="font-size:11px;color:var(--dim);display:block;margin-bottom:4px">í‘œì‹œ ì´ë¦„</label>
      <input name="title" class="inp" placeholder="My Service">
    </div>
    <div>
      <label style="font-size:11px;color:var(--dim);display:block;margin-bottom:4px">ì„¤ëª…</label>
      <input name="desc" class="inp" placeholder="ì„œë¹„ìŠ¤ ì„¤ëª…...">
    </div>
    <div style="display:flex;gap:10px">
      <div style="flex:1">
        <label style="font-size:11px;color:var(--dim);display:block;margin-bottom:4px">ì„œë¹„ìŠ¤ íƒ€ì…</label>
        <select name="service" class="inp">{ì˜µì…˜ë“¤}</select>
      </div>
      <div style="flex:1">
        <label style="font-size:11px;color:var(--dim);display:block;margin-bottom:4px">ì•„ì´ì½˜ (ì´ëª¨ì§€)</label>
        <input name="icon" class="inp" placeholder="ğŸ“¦" value="ğŸ“¦" maxlength="4">
      </div>
    </div>
    <button type="submit" class="btn" style="margin-top:6px">ë“±ë¡</button>
  </form>
</div>
<div class="card">
  <h3>ì´ë¦„ ê·œì¹™</h3>
  <div style="font-size:11px;color:var(--dim);line-height:1.8">
    â€¢ ì²« ê¸€ì: ì˜ì–´ (a-z, A-Z)<br>
    â€¢ ë‚˜ë¨¸ì§€: ì˜ì–´, ìˆ«ì, _, - (ìµœëŒ€ 63ì)<br>
    â€¢ ë“±ë¡ í›„: <code class="mono" style="background:var(--bg);padding:2px 6px;border-radius:3px">ctp://ì´ë¦„.crowny</code> â†”
      <code class="mono" style="background:var(--bg);padding:2px 6px;border-radius:3px">crownybus.com/ì´ë¦„</code>
  </div>
</div>
"""
    ë°˜í™˜ í˜ì´ì§€("ì„œë¹„ìŠ¤ ë“±ë¡", ë³¸ë¬¸, "register")


í•¨ìˆ˜ RNSí˜ì´ì§€():
    ì„œë¹„ìŠ¤ëª©ë¡ = RNS.ì „ì²´ëª©ë¡()
    í†µê³„ = RNS.í†µê³„()

    í–‰ë“¤ = ""
    ê°ê° s ì•ˆì— ì„œë¹„ìŠ¤ëª©ë¡:
        í–‰ë“¤ += f"""<tr>
<td>{s['icon']} {s['title']}</td>
<td class="mono" style="color:var(--gold)">ctp://{s['name']}.crowny</td>
<td class="mono">crownybus.com/{s['name']}</td>
<td><span class="tag">{s['service']}</span></td>
<td class="mono">{s['hits']}</td></tr>"""

    ë³¸ë¬¸ = f"""
<div class="hero" style="padding:20px 0">
  <h1>ğŸŒ RNS â€” Resolve Name Service</h1>
  <p>CTP í”„ë¡œí† ì½œ ì´ë¦„ í•´ì„ ì„œë¹„ìŠ¤ ({í†µê³„['records']}ë ˆì½”ë“œ) â€” í•œì„ ì–´ êµ¬ë™</p>
</div>
<div class="card">
  <h3>ë“±ë¡ëœ ì„œë¹„ìŠ¤</h3>
  <table style="width:100%;border-collapse:collapse;font-size:11px">
    <thead><tr>
      <th style="text-align:left;padding:8px 6px;color:var(--mute);border-bottom:1px solid var(--bd)">ì´ë¦„</th>
      <th style="text-align:left;padding:8px 6px;color:var(--mute);border-bottom:1px solid var(--bd)">CTP ì£¼ì†Œ</th>
      <th style="text-align:left;padding:8px 6px;color:var(--mute);border-bottom:1px solid var(--bd)">ì›¹ ì£¼ì†Œ</th>
      <th style="text-align:left;padding:8px 6px;color:var(--mute);border-bottom:1px solid var(--bd)">íƒ€ì…</th>
      <th style="text-align:left;padding:8px 6px;color:var(--mute);border-bottom:1px solid var(--bd)">ì¡°íšŒ</th>
    </tr></thead>
    <tbody>{í–‰ë“¤}</tbody>
  </table>
</div>
<div class="card">
  <h3>ğŸ“¡ CTP í”„ë¡œí† ì½œ</h3>
  <div style="font-size:11px;color:var(--dim);line-height:1.8">
    <b style="color:var(--gold)">CTP (Crowny Transfer Protocol)</b> â€” ê· í˜•ì‚¼ì§„ ë„¤íŠ¸ì›Œí¬ ì „ìš© í”„ë¡œí† ì½œ<br><br>
    ë‚´ë¶€ë§: <code class="mono" style="background:var(--bg);padding:2px 6px;border-radius:3px">ctp://ì„œë¹„ìŠ¤ì´ë¦„.crowny</code><br>
    ì™¸ë¶€ì›¹: <code class="mono" style="background:var(--bg);padding:2px 6px;border-radius:3px">https://crownybus.com/ì„œë¹„ìŠ¤ì´ë¦„</code><br><br>
    í¬ë¼ìš°ë‹ˆ ë¸Œë¼ìš°ì €ì—ì„œëŠ” ctp:// ì£¼ì†Œë¡œ ì§ì ‘ ì ‘ì†,<br>
    ì¼ë°˜ ë¸Œë¼ìš°ì €ì—ì„œëŠ” crownybus.comì„ í†µí•´ RNSê°€ ìë™ ë¼ìš°íŒ…í•©ë‹ˆë‹¤.
  </div>
</div>
"""
    ë°˜í™˜ í˜ì´ì§€("RNS", ë³¸ë¬¸, "rns")


í•¨ìˆ˜ ì„œë¹„ìŠ¤í˜ì´ì§€(ì´ë¦„, ë ˆì½”ë“œ):
    ë³¸ë¬¸ = f"""
<div class="hero" style="padding:20px 0">
  <div style="font-size:48px;margin-bottom:8px">{ë ˆì½”ë“œ.get('icon','ğŸ“¦')}</div>
  <h1>{ë ˆì½”ë“œ.get('title', ì´ë¦„)}</h1>
  <p>{ë ˆì½”ë“œ.get('desc', '')}</p>
</div>
<div class="card">
  <h3>ì„œë¹„ìŠ¤ ì •ë³´</h3>
  <table style="font-size:12px;line-height:2.2">
    <tr><td style="color:var(--mute);padding-right:20px">CTP ì£¼ì†Œ</td>
        <td class="mono" style="color:var(--gold)">ctp://{ì´ë¦„}.crowny</td></tr>
    <tr><td style="color:var(--mute)">ì›¹ ì£¼ì†Œ</td>
        <td class="mono">crownybus.com/{ì´ë¦„}</td></tr>
    <tr><td style="color:var(--mute)">ì„œë¹„ìŠ¤ íƒ€ì…</td>
        <td><span class="tag">{ë ˆì½”ë“œ.get('service','web')}</span></td></tr>
    <tr><td style="color:var(--mute)">ë¡œì»¬ í¬íŠ¸</td>
        <td class="mono">{ë ˆì½”ë“œ.get('local_port', 'â€”')}</td></tr>
    <tr><td style="color:var(--mute)">ì¡°íšŒ ìˆ˜</td>
        <td>{ë ˆì½”ë“œ.get('hits', 0)}íšŒ</td></tr>
  </table>
</div>
<div class="card">
  <h3>ì ‘ì† ë°©ë²•</h3>
  <div style="font-size:12px;line-height:2;color:var(--dim)">
    <b style="color:var(--fg)">í¬ë¼ìš°ë‹ˆ ë¸Œë¼ìš°ì €:</b>
    <code class="mono" style="background:var(--bg);padding:2px 8px;border-radius:4px;color:var(--gold)">ctp://{ì´ë¦„}.crowny</code><br>
    <b style="color:var(--fg)">ë¡œì»¬ ë„¤íŠ¸ì›Œí¬:</b>
    <code class="mono" style="background:var(--bg);padding:2px 8px;border-radius:4px">http://localhost:{ë ˆì½”ë“œ.get('local_port', '?')}</code><br>
    <b style="color:var(--fg)">ê³µê°œ ì›¹:</b>
    <code class="mono" style="background:var(--bg);padding:2px 8px;border-radius:4px">https://crownybus.com/{ì´ë¦„}</code>
  </div>
</div>
<div style="text-align:center;margin-top:16px">
  <a href="/" class="btn" style="text-decoration:none">â† ì„œë¹„ìŠ¤ ëª©ë¡</a>
</div>
"""
    ë°˜í™˜ í˜ì´ì§€(ë ˆì½”ë“œ.get("title", ì´ë¦„), ë³¸ë¬¸)


í•¨ìˆ˜ ë¯¸ë“±ë¡í˜ì´ì§€(ì´ë¦„):
    ë³¸ë¬¸ = f"""
<div class="hero">
  <div style="font-size:48px;margin-bottom:8px">â“</div>
  <h1>ctp://{ì´ë¦„}.crowny</h1>
  <p style="color:var(--dn)">ë“±ë¡ë˜ì§€ ì•Šì€ ì„œë¹„ìŠ¤ì…ë‹ˆë‹¤</p>
</div>
<div style="text-align:center;margin-top:20px">
  <a href="/register" class="btn" style="text-decoration:none;margin-right:10px">ì„œë¹„ìŠ¤ ë“±ë¡</a>
  <a href="/" class="btn" style="text-decoration:none;background:var(--bg);color:var(--gold);border:1px solid var(--bd)">ì„œë¹„ìŠ¤ ëª©ë¡</a>
</div>
"""
    ë°˜í™˜ í˜ì´ì§€("ë¯¸ë“±ë¡", ë³¸ë¬¸)


â€» â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
â€» HTTP í•¸ë“¤ëŸ¬
â€» â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

í´ë˜ìŠ¤ í•¸ë“¤ëŸ¬(BaseHTTPRequestHandler):

    í•¨ìˆ˜ log_message(ìê¸°, *a):
        ì „ë‹¬

    í•¨ìˆ˜ _html(ìê¸°, html, code=200):
        ë³¸ë¬¸ = html.encode("utf-8")
        ìê¸°.send_response(code)
        ìê¸°.send_header("Content-Type", "text/html; charset=utf-8")
        ìê¸°.send_header("Access-Control-Allow-Origin", "*")
        ìê¸°.end_headers()
        ìê¸°.wfile.write(ë³¸ë¬¸)

    í•¨ìˆ˜ _json(ìê¸°, ìë£Œ, code=200):
        ë³¸ë¬¸ = json.dumps(ìë£Œ, ensure_ascii=ê±°ì§“, default=ë¬¸ìì—´).encode("utf-8")
        ìê¸°.send_response(code)
        ìê¸°.send_header("Content-Type", "application/json; charset=utf-8")
        ìê¸°.send_header("Access-Control-Allow-Origin", "*")
        ìê¸°.send_header("Access-Control-Allow-Methods", "GET,POST,OPTIONS")
        ìê¸°.send_header("Access-Control-Allow-Headers", "Content-Type")
        ìê¸°.end_headers()
        ìê¸°.wfile.write(ë³¸ë¬¸)

    í•¨ìˆ˜ do_OPTIONS(ìê¸°):
        ìê¸°.send_response(200)
        ìê¸°.send_header("Access-Control-Allow-Origin", "*")
        ìê¸°.send_header("Access-Control-Allow-Methods", "GET,POST,OPTIONS")
        ìê¸°.send_header("Access-Control-Allow-Headers", "Content-Type")
        ìê¸°.end_headers()

    í•¨ìˆ˜ do_GET(ìê¸°):
        ë¶„ì„ê²°ê³¼ = urlparse(ìê¸°.path)
        ê²½ë¡œ = ë¶„ì„ê²°ê³¼.path.rstrip("/") ë˜ëŠ” "/"

        // ì •ì  í˜ì´ì§€
        ë§Œì•½ ê²½ë¡œ == "/":
            ìê¸°._html(í¬íƒˆí˜ì´ì§€())
        ì•„ë‹ˆë©´ë§Œì•½ ê²½ë¡œ == "/register":
            ìê¸°._html(ë“±ë¡í˜ì´ì§€())
        ì•„ë‹ˆë©´ë§Œì•½ ê²½ë¡œ == "/rns":
            ìê¸°._html(RNSí˜ì´ì§€())
        ì•„ë‹ˆë©´ë§Œì•½ ê²½ë¡œ == "/health":
            ìê¸°._json({"status": "ok", "version": ë²„ì „, "engine": "í•œì„ ì–´", "records": ê¸¸ì´(RNS.ë ˆì½”ë“œ)})
        ì•„ë‹ˆë©´ë§Œì•½ ê²½ë¡œ == "/favicon.ico":
            ìê¸°.send_response(204)
            ìê¸°.end_headers()

        // API
        ì•„ë‹ˆë©´ë§Œì•½ ê²½ë¡œ == "/api/rns/list":
            ìê¸°._json(RNS.ì „ì²´ëª©ë¡())
        ì•„ë‹ˆë©´ë§Œì•½ ê²½ë¡œ == "/api/rns/stats":
            ìê¸°._json(RNS.í†µê³„())
        ì•„ë‹ˆë©´ë§Œì•½ ê²½ë¡œ.startswith("/api/rns/resolve/"):
            ì´ë¦„ = ê²½ë¡œ.split("/")[-1]
            ìê¸°._json(RNS.í•´ì„(ì´ë¦„))
        ì•„ë‹ˆë©´ë§Œì•½ ê²½ë¡œ.startswith("/api/rns/validate/"):
            ì´ë¦„ = ê²½ë¡œ.split("/")[-1]
            ì„±ê³µ, ì˜¤ë¥˜ = RNS.ì´ë¦„ê²€ì¦(ì´ë¦„)
            ìê¸°._json({"valid": ì„±ê³µ, "error": ì˜¤ë¥˜})

        // CTP ë¼ìš°íŒ…: /xxx â†’ ctp://xxx.crowny
        ì•„ë‹ˆë©´:
            ì´ë¦„ = ê²½ë¡œ.lstrip("/").split("/")[0].lower()
            ë§Œì•½ ì´ë¦„ ê·¸ë¦¬ê³  ì´ë¦„ê·œì¹™.match(ì´ë¦„):
                ë ˆì½”ë“œ = RNS.í•´ì„(ì´ë¦„)
                ë§Œì•½ "error" ì•„ë‹Œ ì•ˆì— ë ˆì½”ë“œ:
                    ìê¸°._html(ì„œë¹„ìŠ¤í˜ì´ì§€(ì´ë¦„, ë ˆì½”ë“œ))
                ì•„ë‹ˆë©´:
                    ìê¸°._html(ë¯¸ë“±ë¡í˜ì´ì§€(ì´ë¦„), 404)
            ì•„ë‹ˆë©´:
                ìê¸°._json({"error": "Not Found"}, 404)

    í•¨ìˆ˜ do_POST(ìê¸°):
        ë¶„ì„ê²°ê³¼ = urlparse(ìê¸°.path)
        ê²½ë¡œ = ë¶„ì„ê²°ê³¼.path.rstrip("/") ë˜ëŠ” "/"
        ê¸¸ì´ê°’ = ì •ìˆ˜(ìê¸°.headers.get("Content-Length", 0))
        ì›ë³¸ = ìê¸°.rfile.read(ê¸¸ì´ê°’) ë§Œì•½ ê¸¸ì´ê°’ ì•„ë‹ˆë©´ b""

        ë§Œì•½ ê²½ë¡œ == "/register":
            // HTML í¼ POST
            urllib.parseì—ì„œ ê°€ì ¸ì˜¤ê¸° parse_qs ~ë¡œ pqs
            ë³¸ë¬¸ = pqs(ì›ë³¸.decode("utf-8"))
            ì´ë¦„ = ë³¸ë¬¸.get("name", [""])[0].strip().lower()
            ì„œë¹„ìŠ¤ = ë³¸ë¬¸.get("service", ["web"])[0]
            ì œëª© = ë³¸ë¬¸.get("title", [""])[0]
            ì„¤ëª… = ë³¸ë¬¸.get("desc", [""])[0]
            ì•„ì´ì½˜ = ë³¸ë¬¸.get("icon", ["ğŸ“¦"])[0]

            ê²°ê³¼ = RNS.ë“±ë¡(ì´ë¦„, ì„œë¹„ìŠ¤, ì œëª©, ì„¤ëª…, ì•„ì´ì½˜)
            ë§Œì•½ "error" ì•ˆì— ê²°ê³¼:
                ìê¸°._html(ë“±ë¡í˜ì´ì§€(f'<span class="err">âŒ {ê²°ê³¼["error"]}</span>'))
            ì•„ë‹ˆë©´:
                ìê¸°._html(ë“±ë¡í˜ì´ì§€(
                    f'<span class="ok">âœ… ë“±ë¡ ì™„ë£Œ!</span> '
                    f'<code class="mono">ctp://{ì´ë¦„}.crowny</code> â†” '
                    f'<code class="mono">crownybus.com/{ì´ë¦„}</code>'))

        ì•„ë‹ˆë©´ë§Œì•½ ê²½ë¡œ == "/api/rns/register":
            // JSON API
            ì‹œë„:
                ë³¸ë¬¸ = json.loads(ì›ë³¸)
            ì˜ˆì™¸:
                ìê¸°._json({"error": "JSON íŒŒì‹± ì˜¤ë¥˜"}, 400)
                ë°˜í™˜
            ê²°ê³¼ = RNS.ë“±ë¡(
                ë³¸ë¬¸.get("name", ""),
                ë³¸ë¬¸.get("service", "web"),
                ë³¸ë¬¸.get("title", ""),
                ë³¸ë¬¸.get("desc", ""),
                ë³¸ë¬¸.get("icon", "ğŸ“¦"),
                ë³¸ë¬¸.get("owner", "api"),
            )
            ìê¸°._json(ê²°ê³¼, 200 ë§Œì•½ "ok" ì•ˆì— ê²°ê³¼ ì•„ë‹ˆë©´ 400)

        ì•„ë‹ˆë©´ë§Œì•½ ê²½ë¡œ == "/api/rns/delete":
            ì‹œë„:
                ë³¸ë¬¸ = json.loads(ì›ë³¸)
            ì˜ˆì™¸:
                ìê¸°._json({"error": "JSON íŒŒì‹± ì˜¤ë¥˜"}, 400)
                ë°˜í™˜
            ìê¸°._json(RNS.ì‚­ì œ(ë³¸ë¬¸.get("name", ""), ë³¸ë¬¸.get("owner", "")))

        ì•„ë‹ˆë©´:
            ìê¸°._json({"error": "Not Found"}, 404)


â€» â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
â€» ë©”ì¸
â€» â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

í•¨ìˆ˜ ë©”ì¸():
    ì„œë²„ = HTTPServer(("0.0.0.0", í¬íŠ¸), í•¸ë“¤ëŸ¬)
    í†µê³„ = RNS.í†µê³„()
    ì¶œë ¥(f"""
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘  ğŸ› CrownyOS ì›¹ ê²Œì´íŠ¸ì›¨ì´ v{ë²„ì „}                      â•‘
â•‘  ğŸ‡°ğŸ‡· í•œì„ ì–´(HanSeon Language)ë¡œ êµ¬ë™                          â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘                                                              â•‘
â•‘  ì›¹:      http://0.0.0.0:{í¬íŠ¸}                              â•‘
â•‘  ë„ë©”ì¸:  crownybus.com                                      â•‘
â•‘  í”„ë¡œí† ì½œ: CTP (Crowny Transfer Protocol)                    â•‘
â•‘  ì—”ì§„:    í•œì„ ì–´ ì¸í„°í”„ë¦¬í„° v1.0                              â•‘
â•‘  RNS:     {í†µê³„['records']}ê°œ ì„œë¹„ìŠ¤ ë“±ë¡                                  â•‘
â•‘                                                              â•‘
â•‘  ë¼ìš°íŒ…:                                                     â•‘
â•‘    crownybus.com/xxx â†’ ctp://xxx.crowny                     â•‘
â•‘                                                              â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
""")
    ì„œë²„.serve_forever()


ë§Œì•½ __name__ == "__main__":
    ë©”ì¸()
